---
interact_link: content/08/3/observers.ipynb
kernel_name: matlab
kernel_path: content/08/3
has_widgets: false
title: |-
  State Observers
pagenum: 38
prev_page:
  url: /08/2/sfcontrol.html
next_page:
  url: /08/4/observer_controller.html
suffix: .ipynb
search: mathbf l x observer c s hat array bf state d begin end cdots t b left states frac right u e vdots dt poles not system y eqnarray n noise feedback error design matrix p form equations w errors lc canonical sn desired alphae alphan alpha mathcal o effect sensor v cannot control because pictures png given eigen values well used ln ce equation process physical possible model solution observed decay zero lhp place short tf ddots quad vector roots ldots pn alphas coefficients using ss gives where block diagram choice controller response very large observers practical cases measure

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">State Observers</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="State-Observers">State Observers<a class="anchor-link" href="#State-Observers"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>In many practical cases it is not possible to measure all the states
of a system.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>That is we cannot form $u=r-\mathbf{Kx}$  for the purposes of
feedback control because we do not have access to $\mathbf{x}$.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>If we know $\mathbf{A}$, $\mathbf{B}$, $\mathbf{C}$, and
$\mathbf{D}$ then it may be possible to reconstruct the states from
one or more of the system outputs by means of an <strong>observer</strong>.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>It is necessary that the system states be observable from the
output(s).</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="State-Observer">State Observer<a class="anchor-link" href="#State-Observer"> </a></h3><p>The main idea is to construct a model of the system and subject it to the same input:</p>
<p><img src="pictures/observer1.png" alt="State Observer"></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Severe differences occur between $\mathbf{x}$ and $\hat{\mathbf{x}}$ due
to disturbances and parameter errors. Solution:- Employ feedback !</p>
<p><strong>NB</strong> To simplify treatment, we take $\mathbf{D}=0$.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="State-Observer-with-Feedback">State Observer with Feedback<a class="anchor-link" href="#State-Observer-with-Feedback"> </a></h3><p><img src="pictures/observer2.png" alt="State Observer with Feedback"></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Observer-state-equations">Observer state equations<a class="anchor-link" href="#Observer-state-equations"> </a></h3><p>For the <strong>observer</strong> we have the state equations:</p>
$$\frac{d{\bf{\hat x}}}{dt} = {\bf{A\hat x}} + {\bf{B}}u + {\bf{L}}\underbrace {(y - {\bf{C\hat x}})}_{\rm{feedback}}$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Observed-State-Errors">Observed State Errors<a class="anchor-link" href="#Observed-State-Errors"> </a></h3><p>Let the error in the estimated states $\hat{\mathbf{x}}$ be:</p>
$$\mathbf{e}=\mathbf{x}-\hat{\mathbf{x}}$$<p></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>then</p>
$$\frac{d\mathbf{e}}{dt}=\frac{d\mathbf{x}}{dt}-\frac{d\hat{\mathbf{x}}}{dt}$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Given,</p>
$$\frac{d\mathbf{x}}{dt}=\mathbf{A}\mathbf{x}+\mathbf{B}u\ \mathrm{and}\ y=\mathbf{C}\mathbf{x}$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>then</p>
$$\begin{eqnarray*}
    \frac{d\mathbf{e}}{dt} &amp; = &amp; \left(\mathbf{A}\mathbf{x}+\mathbf{B}u\right)-\left\{\mathbf{A}\hat{\mathbf{x}}+\mathbf{B}u+\mathbf{L}(y-\mathbf{C}\hat{\mathbf{x}})\right\} \\
    &amp; = &amp; \mathbf{A}(\mathbf{x}-\hat{\mathbf{x}})-\mathbf{L}(\mathbf{C}\mathbf{x}-\mathbf{C}\hat{\mathbf{x}}) = \mathbf{Ae}-\mathbf{LCe}\\
    &amp; = &amp; (\mathbf{A}-\mathbf{LC})\mathbf{e}\end{eqnarray*}$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Properties-of-the-Observed-Error-State-Equations">Properties of the Observed Error State Equations<a class="anchor-link" href="#Properties-of-the-Observed-Error-State-Equations"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>These are the state equations for the observer error.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The errors decay to zero with time if the eigen values of
$(\mathbf{A}-\mathbf{LC})$ lie in the left half plane (LHP).</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>In fact we can design the matrix $\mathbf{L}$ to place the eigen
values anywhere we wish</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>If we place them well into the LHP then $\mathbf{e}$ will decay
quickly to zero making the observer states accurately track the
system states $\mathbf{x}$ after a short time.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>$\hat{\mathbf{x}}$ can then be used for feedback control.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Design-of-the-L-Matrix">Design of the L Matrix<a class="anchor-link" href="#Design-of-the-L-Matrix"> </a></h2><p>This is particularly easy when we use the observer canonical form.</p>
<p>Given the TF:</p>
$$\frac{Y(s)}{U(s)}=\frac{c_1s^{n-1}+\cdots+c_n}{s^n + a_1s^{n-1}+\cdots+a_n}$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>the matrices of the state space model are:</p>
$$\begin{eqnarray*}
     {\bf{A}} &amp; = &amp; \left[ {\begin{array}{*{20}c}
       { - a_1 } &amp; 1 &amp;  \cdots  &amp; 0  \\
       { - a_2 } &amp; 0 &amp;  \ddots  &amp; {0}  \\
        \vdots  &amp;  \vdots  &amp; {} &amp;  \vdots   \\
       { - a_n } &amp; 0 &amp;  \cdots  &amp; 0  \\
    \end{array}} \right];\quad {\bf{B}} = \left[ {\begin{array}{*{20}c}
       {c_1 }  \\
       {c_2 }  \\
        \vdots   \\
       {c_n }  \\
    \end{array}} \right] \\ 
     {\bf{C}} &amp; = &amp; \left[ {\begin{array}{*{20}c}
       1 &amp; 0 &amp;  \cdots  &amp; 0  \\
    \end{array}} \right];\quad {\bf{D}} = 0 \\  \end{eqnarray*}$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and the feedback vector is:</p>
$$L = \left[ {\begin{array}{*{20}c}
   {l_1 } &amp; {l_2 } &amp;  \cdots  &amp; {l_n }  \\
\end{array}} \right]^T$$<p></p>
<p>The state matrix of the observer is:</p>
$${\bf{A}} - {\bf{LC}} = \left[ {\begin{array}{*{20}c}
   {( - a_1  - l_1 )} &amp; 1 &amp;  \cdots  &amp; 0  \\
   {( - a_2  - l_2 )} &amp; 0 &amp;  \ddots  &amp; 0  \\
    \vdots  &amp;  \vdots  &amp; {} &amp;  \vdots   \\
   {( - a_n  - l_n )} &amp; 0 &amp;  \cdots  &amp; 0  \\
\end{array}} \right]$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The poles of the observer are the roots of the CE:</p>
$$s^n+(a_1+l_1)s^{n-1}+\cdots+(a_n+l_n)=0$$<p>If the desired observer poles are at $s=p_1,p_2,\ldots,p_n$ then the
desired CE equation is:</p>
$$\begin{eqnarray*}
    \alpha_e(s) &amp; = &amp; (s-p_1)(s-p_2)\cdots(s-p_n) \\
                &amp; = &amp; s^n + \alpha_1s^{n-1} + \cdots + \alpha_n = 0\end{eqnarray*}$$<p>The $l$ coefficients may be found by matching the two equations above.
Thus,</p>
$$l_1=\alpha_1-a_1,\ l_2=\alpha_2-a_2,\ \cdots\ l_n=\alpha_n-a_n.$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="In-Class-Example-1">In-Class Example 1<a class="anchor-link" href="#In-Class-Example-1"> </a></h3><p><strong>Problem</strong>: Design an observer with poles or eigen values
$\lambda_{1,2} = -20,\ -20$ using the observer canonical form for the
system with a TF:</p>
$$\frac{Y(s)}{U(s)}=\frac{7}{s^2+15s+44}.$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>SOLUTION</strong>: The observer canonical form gives:</p>
$${\bf{A}} = \left[ {\begin{array}{*{20}c}
   { - 15} &amp; 1  \\
   { - 44} &amp; 0  \\
\end{array}} \right];\;{\bf{B}} = \left[ {\begin{array}{*{20}c}
   0  \\
   7  \\
\end{array}} \right];\;{\bf{C}} = \left[ {\begin{array}{*{20}c}
   1 &amp; 0  \\
\end{array}} \right];\;{\bf{D}} = 0$$<p></p>
<p>with $\mathbf{L}=[l_1,\ l_2]^T$ we
have observer poles at the roots of:</p>
$$s^2+(15+l_1)s+(44+l_2)=0.$$<p>The desired CE is:</p>
$$\alpha_e(s)=(s + 20)(s + 20)=s^2+40s+400=0$$<p>Comparing coefficients gives:</p>
$$\begin{eqnarray*}
    s^1:\ 15 + l_1 &amp; = &amp; 40 \to l_1=25 \\
    s^0:\ 44 + l_2 &amp; = &amp; 400 \to l_2=356 \\ \end{eqnarray*}$$<p>So the observer states are given by:</p>
$$\frac{d\hat{\mathbf{x}}}{dt}=\mathbf{A}\hat{\mathbf{x}}+\mathbf{B}u-\mathbf{L}(\mathbf{C}\hat{\mathbf{x}}-y)$$<p>where $\mathbf{L}=[25\ 356]^T.$</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Block-Diagram-of-the-Observer">Block Diagram of the Observer<a class="anchor-link" href="#Block-Diagram-of-the-Observer"> </a></h4><p><img src="pictures/observer3.png" alt="Block Diagram of the Observer"></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Design-of-L-Matrix-for-Other-Forms-of-State-Equation">Design of L Matrix for Other Forms of State Equation<a class="anchor-link" href="#Design-of-L-Matrix-for-Other-Forms-of-State-Equation"> </a></h2><p>When the observer canonical form is not used, then the design of the
observer is more difficult. Ackermann's formula can be adapted as
follows:</p>
$${\bf{L}}^T  = \left[ {\begin{array}{*{20}c}
   0 &amp;  \ldots  &amp; 0 &amp; 1  \\
\end{array}} \right]\mathcal{O}^{ - 1} \alpha _e ({\bf{A}}^T )$$<p>$\mathcal{O}$ is the observability matrix:</p>
$$\mathcal{O}=[\mathbf{C}^T\vdots\mathbf{A}^T\mathbf{C}^T\vdots\cdots\vdots(\mathbf{A}^T)^{n-1}\mathbf{C}^T]$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and if $\alpha_e(s)=s^n + \alpha_1s^{n-1}+\cdots+\alpha_n$ then</p>
$$\alpha_e(\mathbf{A}^T)=(\mathbf{A}^T)^n + \alpha_1(\mathbf{A}^T)^{n-1}+\cdots+\mathbf{I}\alpha_n.$$
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that if the system is unobservable, then the matrix inverse
$\mathcal{O}^{-1}$ does not exist and we cannot design an observer for
this system.</p>
<p>In MATLAB we could evaluate the $\mathbf{L}$ matrix using:</p>

<pre><code>    L=acker(A',C',p)'

</code></pre>
<p>where <code>p</code> is a vector of desired observer poles.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Choice-of-Observer-Poles">Choice of Observer Poles<a class="anchor-link" href="#Choice-of-Observer-Poles"> </a></h2><ul>
<li>Rule of thumb: observer poles can be faster than the controller
poles (i.e. further from the origin) by a factor of 2 to 6. This
makes the effect of the observer dynamics short-term and the overall
response is dominated by the controller poles.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p>If noise/disturbance is present this has an effect on the choice:</p>
<p><strong>Process noise</strong> $w$: $d\mathbf{x}/dt=\mathbf{Ax}+\mathbf{B}u+\mathbf{B}_1 w$</p>
<p><strong>Sensor noise</strong> $v$: $y = \mathbf{C}x+v$</p>
<p><strong>Observer</strong>: $d\hat{\mathbf{x}}=\mathbf{A}\hat{\mathbf{x}}+\mathbf{B}u+\mathbf{L}(y-\mathbf{C}\hat{\mathbf{x}})$</p>
<p><strong>Error</strong> $\mathbf{e}=\mathbf{x}-\hat{\mathbf{x}}$: $d\mathbf{e}/dt=(\mathbf{A}-\mathbf{LC})\mathbf{e}+\mathbf{B}_1 w - \mathbf{L}v.$</p>
</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the error equation, the sensor noise is multiplied by $\mathbf{L}$
and the process noise is not. Therefore,</p>
<ol>
<li><p>if $\mathbf{L}$ is very small, the effect of sensor noise $v$ is
removed but the observer is "slow" to respond, so that the error
will not reject the effect of $w$ very well.</p>
</li>
<li><p>if $\mathbf{L}$ is large, the observer response is "fast" and the
error rejects the process noise $w$ well, but the sensor noise $v$
is amplified by $\mathbf{L}$ resulting in large errors.</p>
</li>
</ol>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Optimal control design methods can be used to achieve the "best"
compromise.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Footnote">Footnote<a class="anchor-link" href="#Footnote"> </a></h2><ol>
<li>Or some states in $\mathbf{x}$, either because the states are not <em>physical states</em> and hence cannot be measured, or because they <em>are</em> physical states but we do not have suitable sensors for the physical quantity that is represented by the state.</li>
</ol>

</div>
</div>
</div>
</div>

 


    </main>
    